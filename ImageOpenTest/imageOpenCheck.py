from PIL import Image
import cStringIO

def get_image():
    output_body = cStringIO.StringIO()
    try:
        print 'before'
        orig_image = Image.open('/home/jnoor/PycharmProjects/myCode/hackerrank/ImageOpenTest/power-of-light.jpg')
        print 'after'
    except:
        print("Not a valid Image")

    # try:
    #     orig_image.load()
    # except:
    #     print('image load problem')

    orig_image.save(output_body, 'jpeg')
    #flo = cStringIO.StringIO(output_body.getvalue())
    #print 'get image ok', output_body
    return output_body, Image.open(cStringIO.StringIO(output_body.getvalue()))


def upload_image_object(img, progressive=False):
    data_buffer = cStringIO.StringIO()
    try:
        print img
        img.save(data_buffer, 'jpeg', progressive=progressive)
        data_buffer.close()
    except:
        data_buffer.close()
        raise Exception("failed to upload image object {} ".format(destination))


try:
    #image = Image.open('power-of-light.jpg')
    data_string_buffer, crp_image = get_image()
    print data_string_buffer, crp_image
    data_string_buffer.close()
    upload_image_object(crp_image, progressive=True)
    upload_image_object(crp_image, progressive=True)

except Exception as e:
    print 'global exception'
    print e
